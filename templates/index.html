<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickShare | Flip Transfer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f8fafc;
            overflow-x: hidden;
            perspective: 1000px; /* Essential for 3D effect */
        }

        /* --- Aurora Background --- */
        .aurora-bg {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1;
            background: 
                radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.15) 0, transparent 50%), 
                radial-gradient(at 100% 0%, rgba(236, 72, 153, 0.15) 0, transparent 50%), 
                radial-gradient(at 100% 100%, rgba(34, 211, 238, 0.15) 0, transparent 50%), 
                radial-gradient(at 0% 100%, rgba(251, 191, 36, 0.15) 0, transparent 50%);
            background-size: 200% 200%;
            animation: aurora 20s ease infinite alternate;
        }
        @keyframes aurora { 0% { background-position: 0% 0%; } 100% { background-position: 100% 100%; } }

        /* --- 3D Flip Mechanics --- */
        .flip-container {
            width: 100%;
            max-width: 500px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Bouncy transition */
        }

        .flip-container.flipped {
            transform: rotateY(180deg);
        }

        /* Common Face Styles */
        .card-face {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 20px 40px -5px rgba(0, 0, 0, 0.1);
            border-radius: 32px;
            padding: 2rem;
            width: 100%;
        }

        /* Front Face (Send) */
        .face-front {
            position: relative; /* Takes up space in DOM */
            z-index: 2;
            transform: rotateY(0deg);
        }

        /* Back Face (Receive) */
        .face-back {
            position: absolute; /* Overlays front */
            top: 0; left: 0;
            height: 100%;
            z-index: 1;
            transform: rotateY(180deg);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* --- UI Elements --- */
        .modern-input {
            background: #ffffff; border: 2px solid #e2e8f0; transition: all 0.2s ease; color: #0f172a;
        }
        .modern-input:focus {
            border-color: #6366f1; box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1); outline: none;
        }
        
        .drop-zone {
            background-color: rgba(255, 255, 255, 0.6);
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='20' ry='20' stroke='%23CBD5E1FF' stroke-width='2' stroke-dasharray='12%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
            transition: all 0.3s ease;
        }
        .drop-zone:hover, .drop-zone.highlight {
            background-color: #eff6ff;
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='20' ry='20' stroke='%236366F1FF' stroke-width='2' stroke-dasharray='12%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
        }

        .btn-gradient {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            transition: all 0.3s ease;
        }
        .btn-gradient:hover:not(:disabled) { opacity: 0.95; transform: translateY(-1px); box-shadow: 0 10px 20px -5px rgba(79, 70, 229, 0.4); }
        .btn-gradient:disabled { background: #cbd5e1; cursor: not-allowed; }
    </style>
</head>
<body class="flex flex-col min-h-screen text-slate-900">

    <div class="aurora-bg"></div>
    
    <div class="flex-grow flex items-center justify-center p-4">
        
        <div class="flip-container" id="flipCard">
            
            <div class="card-face face-front">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h1 class="text-2xl font-extrabold text-slate-900">QuickShare</h1>
                        <p class="text-sm text-slate-500 font-medium">Send Content</p>
                    </div>
                    <button onclick="toggleFlip()" class="group flex items-center gap-2 bg-slate-100 hover:bg-slate-200 px-3 py-2 rounded-xl transition-all">
                        <span class="text-xs font-bold text-slate-600">Receive</span>
                        <div class="w-6 h-6 bg-white rounded-full flex items-center justify-center shadow-sm text-indigo-600 group-hover:rotate-180 transition-transform duration-500">
                            <i class="fa-solid fa-arrow-right-arrow-left text-[10px]"></i>
                        </div>
                    </button>
                </div>

                <form id="uploadForm" class="space-y-5">
                    <div id="drop-area" class="drop-zone rounded-[24px] p-6 text-center cursor-pointer relative group">
                        <input type="file" id="fileInput" name="file" class="hidden" multiple onchange="renderFileList()">
                        <div class="transition-transform duration-300 group-hover:scale-105">
                            <div class="w-10 h-10 mx-auto bg-white rounded-full flex items-center justify-center text-indigo-600 mb-2 shadow-sm border border-slate-100">
                                <i class="fa-solid fa-cloud-arrow-up"></i>
                            </div>
                            <h3 class="font-bold text-slate-800 text-sm">Upload Files</h3>
                        </div>
                    </div>

                    <textarea id="linksInput" name="links" 
                        class="modern-input w-full p-4 rounded-2xl text-sm font-medium min-h-[80px] resize-none" 
                        placeholder="Paste text, links, or code snippets..." oninput="renderFileList()"></textarea>

                    <div id="fileListContainer" class="hidden">
                        <ul id="fileList" class="space-y-2 max-h-32 overflow-y-auto pr-1"></ul>
                    </div>

                    <button type="submit" class="btn-gradient w-full py-3.5 rounded-2xl text-white font-bold shadow-xl flex justify-center items-center gap-2" disabled>
                        <span>Create Link</span> <i class="fa-solid fa-magic text-xs"></i>
                    </button>
                </form>

                <div id="uploadProgressContainer" class="mt-4 hidden">
                    <div class="h-1.5 w-full bg-slate-100 rounded-full overflow-hidden">
                        <div id="progressBarFill" class="h-full bg-indigo-500 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>
                <div id="uploadResult" class="mt-4 empty:hidden"></div>
            </div>

            <div class="card-face face-back">
                
                <div class="flex justify-between items-start mb-8">
                    <div>
                        <h1 class="text-2xl font-extrabold text-slate-900">QuickShare</h1>
                        <p class="text-sm text-slate-500 font-medium">Download</p>
                    </div>
                    <button onclick="toggleFlip()" class="group flex items-center gap-2 bg-slate-100 hover:bg-slate-200 px-3 py-2 rounded-xl transition-all">
                        <div class="w-6 h-6 bg-white rounded-full flex items-center justify-center shadow-sm text-emerald-600 group-hover:-rotate-180 transition-transform duration-500">
                            <i class="fa-solid fa-arrow-right-arrow-left text-[10px]"></i>
                        </div>
                        <span class="text-xs font-bold text-slate-600">Send</span>
                    </button>
                </div>

                <div class="text-center space-y-6">
                    <div class="w-20 h-20 bg-indigo-50 rounded-full mx-auto flex items-center justify-center text-indigo-500 mb-2 animate-pulse">
                        <i class="fa-solid fa-download text-3xl"></i>
                    </div>
                    
                    <form id="downloadForm" class="space-y-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-400 uppercase tracking-widest mb-2">Enter 6-Digit Code</label>
                            <input type="text" name="code" 
                                class="modern-input w-full p-4 rounded-2xl text-center font-mono text-3xl font-bold tracking-[0.5em] text-slate-900 placeholder:text-slate-200 placeholder:tracking-normal" 
                                placeholder="000000" maxlength="6" required autocomplete="off">
                        </div>
                        <button type="submit" class="w-full bg-slate-900 hover:bg-slate-800 text-white py-4 rounded-2xl font-bold transition-colors shadow-lg">
                            Download Content
                        </button>
                    </form>
                </div>
                
                <div class="mt-8 text-center">
                    <p class="text-[10px] text-slate-400">Content expires automatically after 5 minutes.</p>
                </div>
            </div>

        </div>

        <footer class="fixed bottom-4 left-0 w-full text-center pointer-events-none">
            <div class="pointer-events-auto inline-flex items-center gap-6 bg-white/80 backdrop-blur-md px-6 py-2 rounded-full shadow-sm border border-white/50">
                <a href="https://linkedin.com/in/keyurbhatiya" target="_blank" class="text-slate-400 hover:text-[#0077b5] transition-transform hover:scale-110"><i class="fab fa-linkedin"></i></a>
                <a href="https://github.com/keyurbhatiya" target="_blank" class="text-slate-400 hover:text-slate-900 transition-transform hover:scale-110"><i class="fab fa-github"></i></a>
                <a href="https://keyurbhatiya.com" target="_blank" class="text-slate-400 hover:text-indigo-600 transition-transform hover:scale-110"><i class="fa-solid fa-globe"></i></a>
            </div>
            <p class="text-[10px] text-slate-400 font-medium mt-2">Â© 2025 Keyur Bhatiya</p>
        </footer>
    </div>

<script>
    // --- Flip Logic ---
    function toggleFlip() {
        document.getElementById('flipCard').classList.toggle('flipped');
    }

    // --- Configuration ---
    const EXPIRATION_SECONDS = 5 * 60; 
    let countdownInterval = null;
    const els = {
        dropArea: document.getElementById('drop-area'),
        fileInput: document.getElementById('fileInput'),
        linksInput: document.getElementById("linksInput"),
        uploadForm: document.getElementById("uploadForm"),
        submitBtn: document.getElementById("uploadForm").querySelector('button[type="submit"]'),
        progressContainer: document.getElementById("uploadProgressContainer"),
        progressBar: document.getElementById("progressBarFill"),
        resultArea: document.getElementById("uploadResult"),
        fileListContainer: document.getElementById("fileListContainer"),
        fileList: document.getElementById("fileList")
    };

    // --- Render File List ---
    window.renderFileList = () => {
        const textVal = els.linksInput.value.trim();
        const files = els.fileInput.files;
        const hasContent = textVal.length > 0 || files.length > 0;

        els.fileList.innerHTML = '';
        els.fileListContainer.classList.toggle('hidden', !hasContent);
        els.submitBtn.disabled = !hasContent;
        
        if (textVal) {
            els.fileList.innerHTML += `
                <li class="flex justify-between items-center text-xs p-2 bg-slate-50 rounded-lg border border-slate-100">
                    <span class="font-bold text-slate-700"><i class="fa-solid fa-align-left mr-2 text-indigo-400"></i>Text</span>
                    <button type="button" onclick="clearText()" class="text-slate-400 hover:text-red-500"><i class="fa-solid fa-times"></i></button>
                </li>`;
        }
        Array.from(files).forEach(f => {
            els.fileList.innerHTML += `
                <li class="text-xs p-2 bg-slate-50 rounded-lg border border-slate-100 flex items-center text-slate-600">
                    <i class="fa-regular fa-file mr-2 text-emerald-500"></i> ${f.name}
                </li>`;
        });
    };

    window.clearText = () => { els.linksInput.value = ''; renderFileList(); }

    // --- Drag & Drop ---
    const prevent = (e) => { e.preventDefault(); e.stopPropagation(); };
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(evt => els.dropArea.addEventListener(evt, prevent));
    els.dropArea.addEventListener('dragenter', () => els.dropArea.classList.add('highlight'));
    els.dropArea.addEventListener('dragleave', () => els.dropArea.classList.remove('highlight'));
    els.dropArea.addEventListener('drop', (e) => {
        els.dropArea.classList.remove('highlight');
        els.fileInput.files = e.dataTransfer.files;
        renderFileList();
    });
    els.dropArea.addEventListener('click', () => els.fileInput.click());

    // --- Upload ---
    els.uploadForm.addEventListener("submit", (e) => {
        e.preventDefault();
        els.resultArea.innerHTML = '';
        els.progressContainer.classList.remove('hidden');
        els.submitBtn.disabled = true;
        els.submitBtn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i>';
        
        const formData = new FormData();
        const textVal = els.linksInput.value.trim();
        if (textVal) formData.append('links', textVal);
        Array.from(els.fileInput.files).forEach(f => formData.append('file', f, f.name));

        const xhr = new XMLHttpRequest();
        xhr.open('POST', '/api/upload', true);
        xhr.upload.addEventListener('progress', (e) => {
            if (e.lengthComputable) els.progressBar.style.width = `${Math.round((e.loaded / e.total) * 100)}%`;
        });
        xhr.onload = () => {
            els.progressContainer.classList.add('hidden');
            els.submitBtn.disabled = false;
            els.submitBtn.innerHTML = 'Create Link <i class="fa-solid fa-magic text-xs ml-2"></i>';
            try {
                const data = JSON.parse(xhr.responseText);
                if (xhr.status === 200) { saveToLocal(data); showSuccess(data); els.linksInput.value=''; els.fileInput.value=''; renderFileList(); }
                else { showError(data.error); }
            } catch (err) { showError('Server Error'); }
        };
        xhr.onerror = () => { els.progressContainer.classList.add('hidden'); els.submitBtn.disabled = false; showError('Network Error'); };
        xhr.send(formData);
    });

    // --- Results ---
    function showSuccess(data) {
        const downloadUrl = `${window.location.origin}/api/download?code=${data.code}`;
        els.resultArea.innerHTML = `
            <div class="bg-indigo-50/80 rounded-xl p-4 border border-indigo-100 animate-[fadeIn_0.3s_ease-out]">
                <div class="flex justify-between items-center mb-3">
                    <span class="text-xs font-bold text-indigo-900 bg-white px-2 py-1 rounded shadow-sm">Code: <span class="font-mono text-base ml-1">${data.code}</span></span>
                    <span id="timerDisplay" class="text-[10px] font-mono font-bold text-indigo-500">5:00</span>
                </div>
                <div class="flex gap-2">
                    <button onclick="copyText('${data.code}', this)" class="flex-1 bg-white border border-indigo-100 text-indigo-600 text-xs font-bold py-2 rounded-lg hover:bg-indigo-50">Copy Code</button>
                    <button onclick="copyText('${downloadUrl}', this)" class="flex-1 bg-indigo-600 text-white text-xs font-bold py-2 rounded-lg hover:bg-indigo-700">Copy Link</button>
                </div>
            </div>`;
        if(data.timestamp) startTimer(data.timestamp);
    }

    function showError(msg) { els.resultArea.innerHTML = `<p class="text-center text-xs text-red-500 font-bold bg-red-50 p-2 rounded-lg border border-red-100">${msg}</p>`; }

    function startTimer(startTime) {
        if(countdownInterval) clearInterval(countdownInterval);
        const update = () => {
            const left = (startTime + EXPIRATION_SECONDS) - (Date.now() / 1000);
            if(left <= 0) { clearInterval(countdownInterval); localStorage.removeItem('qs_active'); const t = document.getElementById('timerDisplay'); if(t) t.innerText="Expired"; }
            else { const m=Math.floor(left/60), s=Math.floor(left%60).toString().padStart(2,'0'); const t=document.getElementById('timerDisplay'); if(t) t.innerText=`${m}:${s}`; }
        };
        countdownInterval = setInterval(update, 1000); update();
    }

    window.copyText = (text, el) => {
        const t = document.createElement('textarea'); t.value=text; document.body.appendChild(t); t.select(); document.execCommand('copy'); document.body.removeChild(t);
        const old=el.innerText; el.innerText="Copied!"; setTimeout(()=>el.innerText=old, 1000);
    }

    window.saveToLocal = (data) => localStorage.setItem('qs_active', JSON.stringify(data));
    
    // Download Redirect
    document.getElementById("downloadForm").addEventListener("submit", function(e) {
        e.preventDefault();
        const code = this.code.value.trim();
        if (code) window.location.href = `/api/download?code=${code}`;
    });

    // Init
    window.onload = () => {
        const saved = localStorage.getItem('qs_active');
        if(saved) { try { const d = JSON.parse(saved); if((Date.now()/1000) < (d.timestamp + EXPIRATION_SECONDS)) showSuccess(d); else localStorage.removeItem('qs_active'); } catch(e){} }
    }
</script>
</body>
</html>